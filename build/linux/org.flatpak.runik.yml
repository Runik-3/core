app-id: org.flatpak.runik
runtime: org.gnome.Platform
# Need to use an old runtime because the wails toolchain
# relies on webkitgtk2-4.0
runtime-version: '3.38'
sdk: org.gnome.Sdk
sdk-extensions:
  #- org.freedesktop.Sdk.Extension.golang
  #- org.freedesktop.Sdk.Extension.node16
build-options:
  build-args:
    - --share=network
  append-path: /app/lib/sdk/golang/bin:/app/lib/sdk/node/bin
  env:
    GOBIN: /app/bin
    GOROOT: /app/lib/sdk/golang
    NODEROOT: /app/lib/sdk/node
command: runik
finish-args:
  - --share=ipc 
  - --socket=x11
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri 
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=home
  - --filesystem=host
  - --share=network
  - --talk-name=org.kde.StatusNotifierWatcher
modules:
  # Go and Nodejs based on resticity config
  #
  # These deps need to be build form source because gnome 3.38 is not compatible
  # with their respective sdk-extensions.
  #
  # https://github.com/ad-on-is/resticity/blob/main/packaging/flatpak/rclone.yaml
  - name: golang
    buildsystem: simple
    build-commands:
      - mkdir -p $GOROOT
      - mv $(pwd)/* $GOROOT
    sources:
      - type: archive
        url: https://go.dev/dl/go1.22.6.darwin-amd64.tar.gz
        sha256: 9c3c0124b01b5365f73a1489649f78f971ecf84844ad9ca58fde133096ddb61b
  - name: nodejs
    buildsystem: simple
    build-commands:
      - mkdir -p $NODEROOT
      - mv $(pwd)/* $NODEROOT
    sources:
      - type: archive
        url: https://nodejs.org/dist/v21.7.1/node-v21.7.1-linux-x64.tar.xz
        sha256: cb25d7a4aa57d15f280ce45cd72f95e9d2020702b7ca75c7fe632444f7c0452c
  - name: wails
    buildsystem: simple
    build-commands:
      - go version
      - go install github.com/wailsapp/wails/v2/cmd/wails@latest
  - name: runik
    buildsystem: simple
    build-commands:
      - go version
      -  $GOBIN/wails build -o runik
    sources:
      - type: dir 
        path: ../../ 
